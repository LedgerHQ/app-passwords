(this["webpackJsonppasswords-backup"]=this["webpackJsonppasswords-backup"]||[]).push([[0],{189:function(e,t,s){},191:function(e,t,s){},192:function(e,t,s){"use strict";s.r(t);var o=s(0),n=s.n(o),a=s(10),r=s.n(a),c=(s(77),s.p+"static/media/logo.aeffe6a7.svg"),i=(s(78),s(1));var l=function(e){let{text:t,color:s,disabled:n,hidden:a,onClick:r}=e;const[c,l]=Object(o.useState)(!1),d=Object(o.useRef)(null),h=()=>{d.current.value.length||l(!1),document.body.onfocus=null},u=Object(o.useCallback)((()=>{l(!0),document.body.onfocus=h,d.current&&d.current.click()}),[]),p=Object(o.useCallback)((e=>{e.target.files[0].text().then((t=>{e.target.value="",r(t).then((()=>l(!1)))}))}),[r]);return Object(i.jsxs)("button",{className:"RestoreButton",disabled:c|n,onClick:c?null:u,style:{margin:"10px",backgroundColor:s,display:!a||"none"},children:[c?"Loading\u2026":t,Object(i.jsx)("input",{type:"file",ref:d,onChange:p,accept:".json",style:{display:"none"}})]})};s(80);var d=function(e){let{text:t,color:s,disabled:n,hidden:a,onClick:r}=e;const[c,l]=Object(o.useState)(!1),d=Object(o.useCallback)((()=>{l(!0),r().then((e=>{e&&function(e){var t=new Blob([JSON.stringify(e,null,4)],{type:"application/json;charset=utf-8"}),s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download="backup.json",document.body.appendChild(o),o.click(),document.body.removeChild(o)}(e),l(!1)}))}),[r]);return Object(i.jsx)("button",{className:"BackupButton",disabled:c|n,onClick:c?null:d,style:{margin:"10px",backgroundColor:s,display:!a||"none"},children:c?"Loading\u2026":t})},h=s(67),u=s(2),p=s(19),b=s.n(p);s(189);function m(){const[e,t]=Object(o.useState)([]);return Object(i.jsxs)(u.a,{allowZeroExpanded:!0,allowMultipleExpanded:!0,onChange:function(s){if(s.length>e.length){const e=s[s.length-1],t=document.getElementById("accordion__panel-".concat(e)).getBoundingClientRect().bottom;t>window.innerHeight&&window.scrollBy(0,t-window.innerHeight)}t(s)},children:[Object(i.jsxs)(u.b,{children:[Object(i.jsx)(u.d,{children:Object(i.jsx)(u.c,{children:"What is this Web App ?"})}),Object(i.jsx)(u.e,{children:Object(i.jsx)(b.a,{className:"Explanations",children:"This Web App allows you to backup/restore the list of `password nicknames` stored inside the `Passwords app` on your Ledger Nano S/ Nano X.  \n    It is useful to have such a backup when you update the Passwords app on your device, or the device firmware, because the list gets erased. Another case where it's practical to have a nickname backup is when you loose your device: Restoring the [24-words recovery phrase](https://www.ledger.com/academy/crypto/what-is-a-recovery-phrase) is necessary but not sufficient to restore your passwords, you need your nickname list as well.  \n    The backup consists in a human readable `backup.json` file containing a dump of the 4096 bytes of application storage.  \n    Note that all operations of this Web App are done locally on your computer, there are no external communications occurring."})})]}),Object(i.jsxs)(u.b,{children:[Object(i.jsx)(u.d,{children:Object(i.jsx)(u.c,{children:"What is the Ledger Passwords application ?"})}),Object(i.jsx)(u.e,{children:Object(i.jsx)(b.a,{className:"Explanations",children:"Look [here](https://github.com/LedgerHQ/app-passwords/blob/master/README.md) for more information on the device application itself."})})]}),Object(i.jsxs)(u.b,{children:[Object(i.jsx)(u.d,{children:Object(i.jsx)(u.c,{children:"How to use this Web App ?"})}),Object(i.jsx)(u.e,{children:Object(i.jsx)(b.a,{className:"Explanations",children:'* Connect your Nano S/X to your computer and open the `Passwords app`.\n* You can now click on the big `Connect` button, and if it succeeds the `Backup` and `Restore` buttons should replace the previous button. If you have troubles with this step, have a look [here](https://support.ledger.com/hc/en-us/articles/115005165269-Fix-connection-issues). \n* Either click on `Backup` or `Restore` depending on what you want to do:  \n    * `Backup` will prompt a screen requesting your approval on your device (`"Transfer metadatas ?"`), then save a backup file. This is your backup. it\'s not confidential, so for instance you can send it to yourself by e-mail to never loose it.  \n    * `Restore` will prompt a file input dialog where you should indicate a previous backup file. A prompt (`"Overwrite metadatas ?"`) will then request your approval on your device. Done.'})})]}),Object(i.jsxs)(u.b,{children:[Object(i.jsx)(u.d,{children:Object(i.jsx)(u.c,{children:"Which web browsers and operating systems are supported ?"})}),Object(i.jsx)(u.e,{children:Object(i.jsx)(b.a,{className:"Explanations",children:"The communication with the device is done through `WebUSB`, which is currently supported only on `Google Chrome` / `Chromium` / `Brave` for `Linux` and `MacOS`. On `Windows`, you need to first go to `chrome://flags` then search for `Enable new USB backend`, disable it and relaunch Chrome."})})]}),Object(i.jsxs)(u.b,{children:[Object(i.jsx)(u.d,{children:Object(i.jsx)(u.c,{children:"Less common use cases"})}),Object(i.jsx)(u.e,{children:Object(i.jsx)(b.a,{className:"Explanations",children:"* If you ever encounter a WTF-kind of error with your passwords app (some or all of your entries are suddenly gone? A password has changed ?), it is wise to first come here and make a backup. You can then have a look inside the backup file to see if something is wrong (You might also want to create an issue [here](https://github.com/LedgerHQ/app-passwords/issues) so we fix your issue for all users). \n* If you want to add a lot of new passwords, the manual input on the device keyboard will show its limits. You can instead create a backup and edit it manually to add all your new entries. You just have to restore your app with this file and the job is done :)"})})]})]})}var g=s(14),w=(s(190),s(22)),j=s(72);s(191);const f=new h.a;Object(w.a)((e=>{console.log(e)}));var y=function(){function e(e,t){return new Promise((async o=>{let n=null;try{e.connected||(await e.connect(),a(!0),g.b.info("Device connected \ud83d\udc4c",{autoClose:!1})),t&&(g.b.info("Approve action on your device \u2728",{autoClose:!1}),s(!0),n=await t(),g.b.dismiss(),g.b.success("Success \ud83e\udd84"))}catch(r){e.disconnect(),a(!1),g.b.dismiss(),g.b.error("".concat(r.toString()," \ud83d\ude45"))}finally{s(!1),o(n)}}))}const[t,s]=Object(o.useState)(!1),[n,a]=Object(o.useState)(!1);return Object(i.jsxs)("div",{className:"App",children:[Object(i.jsx)(g.a,{hideProgressBar:!0}),Object(i.jsxs)("div",{className:"App-banner",children:[Object(i.jsx)("img",{src:c,className:"App-logo",alt:"logo"}),Object(i.jsx)("p",{className:"App-title",children:"Passwords Backup"})]}),Object(i.jsxs)("header",{className:"App-header",children:[Object(i.jsxs)("div",{className:"Commands",children:[Object(i.jsx)(d,{text:"Connect",color:"#41ccb4",disabled:t,hidden:n,onClick:()=>e(f)}),Object(i.jsx)(d,{text:"Backup",color:"#41ccb4",disabled:t,hidden:!n,onClick:()=>e(f,(()=>f.dump_metadatas()))}),Object(i.jsx)(l,{text:"Restore",color:"#FFB86D",disabled:t,hidden:!n,onClick:t=>e(f,(()=>f.load_metadatas(t)))})]}),Object(i.jsx)(m,{}),Object(i.jsx)("div",{className:"App-footer",children:Object(i.jsxs)("p",{children:["A modest Web App built at Ledger with React, hosted by Github. v","".concat(j.version),"."," ",Object(i.jsx)("a",{href:"https://github.com/LedgerHQ/passwords-backup",children:"PRs welcomed and appreciated \u2728"})]})})]})]})};r.a.render(Object(i.jsx)(n.a.StrictMode,{children:Object(i.jsx)(y,{})}),document.getElementById("root"))},67:function(e,t,s){"use strict";(function(e){var o=s(68);const n=Object.freeze({GET_APP_INFO_COMMAND:1,GET_APP_CONFIG_COMMAND:3,DUMP_METADATAS_COMMAND:4,LOAD_METADATAS_COMMAND:5}),a=Object.freeze({UPPERCASE:1,LOWERCASE:2,NUMBERS:4,MINUS:8,UNDERLINE:16,SPACE:32,SPECIAL:64,BRACKETS:128});t.a=class{constructor(){this.allowedStatuses=[36864,27013,27270,27271,27904,28160,45056],this.connected=!1,this.busy=!1,this.transport=null}async connect(){if(!this.connected){this.transport||(this.transport=await o.a.create());try{const[e,t]=await this.getAppInfo();if("Passwords"!==e.toString())throw new Error("The Passwords app is not opened on the device");this.version=t;let s=await this.getAppConfig();this.storage_size=s.storage_size,this.connected=!0}catch(e){throw await this.transport.close(),this.disconnect(),e}}}isSuccess(e){return e.length>=2&&36864===e.readUInt16BE(e.length-2)}disconnect(){this.connected=!1,this.transport=null}mapProtocolError(e){if(e.length<2)throw new Error("Response length is too small");var t={27013:"Action cancelled",27270:"SW_WRONG_P1P2",27271:"SW_WRONG_DATA_LENGTH",27904:"SW_INS_NOT_SUPPORTED",28160:"SW_CLA_NOT_SUPPORTED",45056:"SW_APPNAME_TOO_LONG",28432:"SW_METADATAS_PARSING_ERROR"};let s=e.readUInt16BE(e.length-2);if(s in t)throw new Error(t[s])}_lock(){if(this.busy)throw new Error("Device is busy");this.busy=!0}_unlock(){this.busy=!1}_charsetListToBitmask(e){let t=0;for(const s of e)t|=a[s];return 0===t&&(t=255),t}_bitmaskToCharsetList(e){let t=[];if(0===e||255===e)t.push("ALL_SETS");else for(const s in a)a[s]&e&&t.push(s);return t}_toBytes(t){let s=e.alloc(this.storage_size),o=JSON.parse(t).parsed,n=0;return o.forEach((e=>{let t=e.nickname,o=this._charsetListToBitmask(e.charsets);if(t.length>19)throw new Error("Nickname too long (19 max): ".concat(t," has length ").concat(t.length));if(n+3+t.length>=this.storage_size)throw new Error("Not enough memory on this device to restore this backup");s[n++]=t.length+1,s[n++]=0,s[n++]=o,s.write(t,n),n+=t.length})),s[n++]=0,s[n++]=0,s}_toJSON(e){let t=[],s=[],o=0,n=[];for(;;){let a=e[o];if(0===a)break;let r=255===e[o+1],c=e[o+2];a>20&&(n+=[o,"nickname too long ".concat(a,", max is 19")]);let i={nickname:e.slice(o+3,o+2+a).toString(),charsets:this._bitmaskToCharsetList(c)};r?s.push(i):t.push(i),o+=a+2}return{parsed:t,nicknames_erased_but_still_stored:s,corruptions_encountered:n,raw_metadatas:e.toString("hex")}}async _load_metadatas_chunk(t,s){let o=await this.transport.send(224,n.LOAD_METADATAS_COMMAND,s?255:0,0,e.from(t),this.allowedStatuses);return this.isSuccess(o)||this.mapProtocolError(o),o}async getAppInfo(){this._lock();try{let s,o,a=await this.transport.send(176,n.GET_APP_INFO_COMMAND,0,0,e(0),this.allowedStatuses);this.isSuccess(a)||this.mapProtocolError(a),a=a.slice(0,a.length-2);try{let e=1,t=a[e++];s=a.slice(e,e+t).toString(),e+=t;let n=a[e++];return o=a.slice(e,e+n).toString(),[s,o]}catch(t){throw new Error("Unexpected result from device, parsing error: ".concat(t))}}finally{this._unlock()}}async getAppConfig(){this._lock();try{let t=await this.transport.send(224,n.GET_APP_CONFIG_COMMAND,0,0,e(0),this.allowedStatuses);if(this.isSuccess(t)||this.mapProtocolError(t),t=t.slice(0,t.length-2),6!==t.length)throw new Error("Can't parse app config of length ".concat(t.length));return{storage_size:t.readUInt32BE(0,4),keyboard_type:t[4],press_enter_after_typing:t[5]}}finally{this._unlock()}}async dump_metadatas(){this._lock();try{let t=e.alloc(0);for(;t.length<this.storage_size;){let s=await this.transport.send(224,n.DUMP_METADATAS_COMMAND,0,0,e(0),this.allowedStatuses);if(this.isSuccess(s)||this.mapProtocolError(s),t=e.concat([t,e.from(s.slice(1,-2))]),255===s[0]&&t.length<this.storage_size)throw new Error("".concat(this.storage_size," bytes requested but only ").concat(t.length," bytes available"))}return this._toJSON(t)}finally{this._unlock()}}async load_metadatas(e){this._lock();try{let t=this._toBytes(e);if(0===t.length)throw new Error("No data to load");for(let e=0;e<t.length;e+=255){let s=t.slice(e,e+255);await this._load_metadatas_chunk(s,e+s.length===t.length)}}finally{this._unlock()}}}}).call(this,s(23).Buffer)},72:function(e){e.exports=JSON.parse('{"name":"passwords-backup","version":"0.1.0","private":true,"homepage":"https://passwords.ledger.com","dependencies":{"@ledgerhq/hw-transport-webusb":"^5.49.0","install":"^0.13.0","react":"^17.0.1","react-accessible-accordion":"^3.3.3","react-dom":"^17.0.1","react-markdown":"^5.0.2","react-toastify":"^6.0.9","web-vitals":"^0.2.4"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@testing-library/jest-dom":"^5.11.4","@testing-library/react":"^11.1.0","@testing-library/user-event":"^12.1.10","gh-pages":"^3.1.0","prettier":"^2.1.2","react-scripts":"4.0.0"}}')},77:function(e,t,s){},78:function(e,t,s){},80:function(e,t,s){}},[[192,1,2]]]);
//# sourceMappingURL=main.fefcc646.chunk.js.map